<ion-content>

  <mat-drawer-container class="example-container" [hasBackdrop]="true">
    <mat-drawer #drawer [mode]="'over'" position="end">

    </mat-drawer>
    <mat-drawer-content>
      <mt-loading [isVisible]="isLoading"></mt-loading>

      <div id="content" class="full-center-page">
        <div class="card-content">
          <ion-row>
            <ion-col sizeXs="12" sizeSm="12" sizeMd="10" sizeLg="10">
              <ion-row>
                @if(cboReport == 'Comparativo'){
                <div style="margin-left: 6px;height: 60px;display: flex;align-items: center;">
                  <div [ngClass]="[isOnlineTienda1 ? 'blob blue': 'blob red']"></div>
                  @if(isOnlineTienda1){
                  <span style="color:rgb(36, 143, 189)"></span>
                  }@else{
                  <span style="color:rgb(212, 53, 53)"></span>
                  }
                </div>
                <ion-col sizeXs="12" sizeSm="12" sizeMd="2" sizeLg="2">
                  <mt-select id="cboStore1" placeHolder="Tiendas" [optionList]="cboStoreAll"
                    (changeSelected)="onChangeSelect($event)"></mt-select>
                </ion-col>
                <ion-col sizeXs="12" sizeSm="12" sizeMd="2" sizeLg="2" *ngIf="isComparationStores">
                  <mt-select id="cboStore2" placeHolder="Tiendas" [optionList]="cboStoreAll"
                    (changeSelected)="onChangeSelect($event)"></mt-select>
                </ion-col>
                <div style="height: 60px;display: flex;align-items: center;" *ngIf="isComparationStores">
                  <div [ngClass]="[isOnlineTienda2 ? 'blob blue': 'blob red']"></div>
                  @if(isOnlineTienda2){
                  <span style="color:rgb(36, 143, 189)"></span>
                  }@else{
                  <span style="color:rgb(212, 53, 53)"></span>
                  }
                </div>
                }@else{<!--simple-->
                <ion-col sizeXs="12" sizeSm="12" sizeMd="2" sizeLg="2">
                  <mt-select id="cboStore" placeHolder="Tiendas" [optionList]="cboStoreAll"
                    (changeSelected)="onChangeSelect($event)"></mt-select>
                </ion-col>
                <div style="height: 60px;display: flex;align-items: center;">
                  <div [ngClass]="[isOnlineTienda ? 'blob blue': 'blob red']"></div>
                  @if(isOnlineTienda){
                  <span style="color:rgb(36, 143, 189)"></span>
                  }@else{
                  <span style="color:rgb(212, 53, 53)"></span>
                  }
                </div>
                }
              </ion-row>
              <ion-row>
                <ion-col sizeXs="12" sizeSm="12" sizeMd="2" sizeLg="2" *ngIf="optionTipoFecha == 'semana'">
                  <mt-select id="cboSemana" placeHolder="Semana" [optionList]="cboSemanaAll"
                    (changeSelected)="onChangeSelect($event)"></mt-select>
                </ion-col>
                <ion-col sizeXs="12" sizeSm="12" sizeMd="2" sizeLg="1" *ngIf="optionTipoFecha == 'semana'">
                  <mt-input id="vAnio_1" label="{{vPlaceholder_anio_1}}" placeholder="{{vPlaceholder_anio_1}}"
                    type="text" value="{{ vAnio_1 }}" (afterChange)="onChangeInput($event)"></mt-input>
                </ion-col>
                <ion-col sizeXs="12" sizeSm="12" sizeMd="2" sizeLg="1"
                  *ngIf="optionTipoFecha == 'semana' && cboReport == 'Comparativo'">
                  <mt-input id="vAnio_2" label="{{vPlaceholder_anio_2}}" placeholder="{{vPlaceholder_anio_2}}"
                    type="text" value="{{ vAnio_2 }}" (afterChange)="onChangeInput($event)"></mt-input>
                </ion-col>
                @if(cboReport == 'Comparativo'){
                <ion-col sizeXs="12" sizeSm="12" sizeMd="2" sizeLg="2" *ngIf="optionTipoFecha == 'fecha'">
                  <mt-calendar id="calendar1" [isPeriodo]="false" [isRange]="true" placeholder="Fechas tienda 1"
                    (afterChange)="onCaledar($event)"></mt-calendar>
                </ion-col>
                <ion-col sizeXs="12" sizeSm="12" sizeMd="2" sizeLg="2" *ngIf="optionTipoFecha == 'fecha'">
                  <mt-calendar id="calendar2" [isPeriodo]="false" [isRange]="true" placeholder="Fechas tienda 2"
                    (afterChange)="onCaledar($event)"></mt-calendar>
                </ion-col>
                }@else{
                <ion-col sizeXs="12" sizeSm="12" sizeMd="2" sizeLg="2" *ngIf="optionTipoFecha == 'fecha'">
                  <mt-calendar id="calendar1" [isPeriodo]="false" [isRange]="true" placeholder="Seleccione las fechas"
                    (afterChange)="onCaledar($event)"></mt-calendar>
                </ion-col>
                }
                <ion-col sizeXs="12" sizeSm="12" sizeMd="2" sizeLg="2" style="display: flex;align-items: center;">
                  <button (click)="onConsultar()" id="searchProducto" type="button" class="btn btn-primary btn-sm"><i
                      class="fa fa-search" aria-hidden="true"></i></button>
                </ion-col>
              </ion-row>
            </ion-col>
            <ion-col sizeXs="12" sizeSm="12" sizeMd="2" sizeLg="2"
              style="display: flex;align-items: end;justify-content: end;">
              <button id="searchProducto" type="button" class="btn btn-secondary btn-sm" style="margin-right: 28px;"
                (click)="toggleMenu($event)">
                <i class="fa fa-cog" aria-hidden="true"></i></button>
              <div class="menu-profile" *ngIf="isVisiblePopover" (click)="$event.stopPropagation()">
                <div class="opciones-menu">
                  <mt-select id="cboReport" placeHolder="Reportes" [optionList]="cboReportAll"
                    (changeSelected)="onChangeSelect($event)"></mt-select>
                </div>
                <div class="opciones-menu">
                  <mt-select id="cboColumn" placeHolder="Tipo columna" [optionList]="cboColunmAll"
                    (changeSelected)="onChangeSelect($event)"></mt-select>
                </div>
                <div class="opciones-menu">
                  <mat-radio-group aria-label="Select an option">
                    <mat-radio-button value="semana" (change)="radioChange($event)">Semana</mat-radio-button>
                    <mat-radio-button value="fecha" (change)="radioChange($event)">Fecha</mat-radio-button>
                  </mat-radio-group>
                </div>
                <div class="opciones-menu">
                  @if(cboReport == 'Comparativo'){
                  <mat-checkbox (change)="checkedChange($event.checked)">
                    Entre tiendas
                  </mat-checkbox>
                  }@else{
                  <mat-checkbox (change)="checkedChange($event.checked)" [disabled]="true" [checked]="false">
                    Entre tiendas
                  </mat-checkbox>
                  }

                </div>
              </div>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col sizeXs="12" sizeSm="12" sizeMd="12" sizeLg="12">
              <div cdkDropList cdkDropListOrientation="mixed" class="example-list" (cdkDropListDropped)="drop($event)">
                @for (card of arCardData; track card) {

                <mat-card class="example-box" cdkDrag class="example-card" appearance="outlined"
                  style="min-width: 650px;background: white;padding: 16px;margin-bottom: 10px;margin-left: 10px;"
                  *ngIf="card.typeReport != 'Comparativo' && cboColumn == 'Familia'">
                  <mat-card-header style="display: contents;width: 100%;padding-bottom: 14px;padding-top: 0px;">
                    <mat-card-title style="width: 100%;">
                      <ion-row>
                        <ion-col sizeXs="12" sizeSm="12" sizeMd="6" sizeLg="6">
                          <p style="font-weight: 500;margin: 0;">{{card.store}}</p>
                          <p style="font-size: 20px;">{{card.column}}</p>
                        </ion-col>
                        <ion-col sizeXs="12" sizeSm="12" sizeMd="6" sizeLg="6" style="text-align: end;">
                          <p style="font-size: 20px;">{{card.departament}}</p>
                          <p style="font-size: 20px;">Semana {{card.semana}}</p>
                        </ion-col>
                      </ion-row>
                    </mat-card-title>
                  </mat-card-header>

                  <table mat-table [dataSource]="card.data" class="example-container mat-elevation-z8" tabindex="0">

                    <ng-container matColumnDef="departamento">
                      <th mat-header-cell *matHeaderCellDef> Departamento </th>
                      <td mat-cell *matCellDef="let element"> {{element.familia}} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"> Total </td>
                    </ng-container>

                    <ng-container matColumnDef="porcentage">
                      <th mat-header-cell *matHeaderCellDef> % </th>
                      <td mat-cell *matCellDef="let element"> %
                      </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter">100 %</td>
                    </ng-container>

                    <ng-container matColumnDef="importe">
                      <th mat-header-cell *matHeaderCellDef> Importe </th>
                      <td mat-cell *matCellDef="let element" class="cellData"> {{ element.importe |
                        currency:'PEN':'symbol':'1.2-2':'es-PE'
                        }} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"> {{card.total_import |
                        currency:'PEN':'symbol':'1.2-2':'es-PE'
                        }} </td>
                    </ng-container>

                    <ng-container matColumnDef="unidades">
                      <th mat-header-cell *matHeaderCellDef> Unid. </th>
                      <td mat-cell *matCellDef="let element" class="cellData"> {{element.unid}}</td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter">{{card.total_und}}</td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns_2"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns_2;"></tr>

                    <tr mat-footer-row *matFooterRowDef="displayedColumns_2" class="example-first-footer-row"></tr>
                  </table>
                </mat-card>

                <mat-card class="example-box" cdkDrag class="example-card" appearance="outlined"
                  style="min-width: 650px;background: white;padding: 16px;margin-bottom: 10px;margin-left: 10px;"
                  *ngIf="card.typeReport == 'Comparativo' && cboColumn == 'Familia'">
                  <mat-card-header style="display: contents;width: 100%;padding-bottom: 14px;padding-top: 0px;">
                    <mat-card-title style="width: 100%;">
                      <ion-row>
                        <ion-col sizeXs="12" sizeSm="12" sizeMd="6" sizeLg="6">
                          <p style="font-weight: 500;margin: 0;">{{card.store}}</p>
                          <p style="font-size: 20px;">{{card.column}}</p>
                        </ion-col>
                        <ion-col sizeXs="12" sizeSm="12" sizeMd="6" sizeLg="6" style="text-align: end;">
                          <p style="font-size: 20px;">{{card.departament}}</p>
                          <p style="font-size: 20px;">Semana {{card.semana}}</p>
                        </ion-col>
                      </ion-row>
                    </mat-card-title>
                  </mat-card-header>

                  <table mat-table [dataSource]="card.data" class="example-container mat-elevation-z8"
                    tabindex="0">

                    <ng-container matColumnDef="departamento1">
                      <th mat-header-cell *matHeaderCellDef> Departamento </th>
                      <td mat-cell *matCellDef="let element"> {{element.familia}} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"> Total </td>
                    </ng-container>

                    <ng-container matColumnDef="anio1">
                      <th mat-header-cell *matHeaderCellDef> Año </th>
                      <td mat-cell *matCellDef="let element" class="cellAnio">{{element.anio_1.anio}}</td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"></td>
                    </ng-container>

                    <ng-container matColumnDef="porcentage1">
                      <th mat-header-cell *matHeaderCellDef> % </th>
                      <td mat-cell *matCellDef="let element">{{element.anio_1.proc_1}} %</td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter">100 %</td>
                    </ng-container>

                    <ng-container matColumnDef="importe1">
                      <th mat-header-cell *matHeaderCellDef> Importe </th>
                      <td mat-cell *matCellDef="let element" class="cellData"> {{element.anio_1.importe |
                        currency:'PEN':'symbol':'1.2-2':'es-PE'
                        }} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"> {{card.total_import_1 |
                        currency:'PEN':'symbol':'1.2-2':'es-PE'
                        }} </td>
                    </ng-container>

                    <ng-container matColumnDef="unidades1">
                      <th mat-header-cell *matHeaderCellDef> Unid. </th>
                      <td mat-cell *matCellDef="let element" class="cellData"> {{element.anio_1.unid}} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter">{{card.total_stock_1}}</td>
                    </ng-container>

                    <ng-container matColumnDef="anio2">
                      <th mat-header-cell *matHeaderCellDef> Año </th>
                      <td mat-cell *matCellDef="let element" class="cellAnio">{{element.anio_2.anio}}</td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"></td>
                    </ng-container>

                    <ng-container matColumnDef="porcentage2">
                      <th mat-header-cell *matHeaderCellDef> % </th>
                      <td mat-cell *matCellDef="let element">{{element.anio_2.proc_2}} %</td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter">100 %</td>
                    </ng-container>

                    <ng-container matColumnDef="importe2">
                      <th mat-header-cell *matHeaderCellDef> Importe </th>
                      <td mat-cell *matCellDef="let element" class="cellData"> {{element.anio_2.importe |
                        currency:'PEN':'symbol':'1.2-2':'es-PE'
                        }} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"> {{card.total_import_2 |
                        currency:'PEN':'symbol':'1.2-2':'es-PE'
                        }} </td>
                    </ng-container>

                    <ng-container matColumnDef="unidades2">
                      <th mat-header-cell *matHeaderCellDef> Unid. </th>
                      <td mat-cell *matCellDef="let element" class="cellData"> {{element.anio_2.unid}} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter">{{card.total_stock_2}}</td>
                    </ng-container>

                    <ng-container matColumnDef="diff_procentage">
                      <th mat-header-cell *matHeaderCellDef style="background: #ffe97b;"> Diff S/. </th>
                      <td mat-cell *matCellDef="let element">{{element.diffPorc}} %</td>
                      <td mat-footer-cell *matFooterCellDef>
                        {{card.diffImportTotal}} %</td>
                    </ng-container>

                    <ng-container matColumnDef="diff_unid">
                      <th mat-header-cell *matHeaderCellDef style="background: #ffe97b;"> Diff Unid </th>
                      <td mat-cell *matCellDef="let element">{{element.diffUnid}} % </td>
                      <td mat-footer-cell *matFooterCellDef>{{card.diffUnidTotal}}
                        %</td>
                    </ng-container>



                    <tr mat-header-row *matHeaderRowDef="displayedColumns_1"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns_1;"></tr>

                    <tr mat-footer-row *matFooterRowDef="displayedColumns_1" class="example-first-footer-row"></tr>
                  </table>
                </mat-card>

                <mat-card class="example-box" cdkDrag class="example-card" appearance="outlined"
                  style="min-width: 650px;background: white;padding: 16px;margin-bottom: 10px;margin-left: 10px;"
                  *ngIf="card.type_report != 'Comparativo' && cboColumn == 'Departamento'">
                  <mat-card-header style="display: contents;width: 100%;padding-bottom: 14px;padding-top: 0px;">
                    <mat-card-title style="width: 100%;">
                      <ion-row>
                        <ion-col sizeXs="12" sizeSm="12" sizeMd="6" sizeLg="6">
                          <p style="font-weight: 500;margin: 0;">{{card.store}}</p>
                          <p style="font-size: 20px;">{{card.column}}</p>
                        </ion-col>
                        <ion-col sizeXs="12" sizeSm="12" sizeMd="6" sizeLg="6" style="text-align: end;">
                          <p style="font-size: 20px;">{{card.title}}</p>
                        </ion-col>
                      </ion-row>
                    </mat-card-title>
                  </mat-card-header>

                  <table mat-table [dataSource]="card.data_simple" class="example-container mat-elevation-z8"
                    tabindex="0">

                    <ng-container matColumnDef="departamento">
                      <th mat-header-cell *matHeaderCellDef> Departamento </th>
                      <td mat-cell *matCellDef="let element"> {{element.departament}} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"> Total </td>
                    </ng-container>

                    <ng-container matColumnDef="porcentage">
                      <th mat-header-cell *matHeaderCellDef> % </th>
                      <td mat-cell *matCellDef="let element"> {{getPorcentage(element.import,card.total_import)}} %
                      </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter">100 %</td>
                    </ng-container>

                    <ng-container matColumnDef="importe">
                      <th mat-header-cell *matHeaderCellDef> Importe </th>
                      <td mat-cell *matCellDef="let element" class="cellData"> {{element.import |
                        currency:'PEN':'symbol':'1.2-2':'es-PE'
                        }} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"> {{card.total_import |
                        currency:'PEN':'symbol':'1.2-2':'es-PE'
                        }} </td>
                    </ng-container>

                    <ng-container matColumnDef="unidades">
                      <th mat-header-cell *matHeaderCellDef> Unid. </th>
                      <td mat-cell *matCellDef="let element" class="cellData"> {{element.unid}} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter">{{card.total_stock}}</td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns_2"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns_2;"></tr>

                    <tr mat-footer-row *matFooterRowDef="displayedColumns_2" class="example-first-footer-row"></tr>
                  </table>
                </mat-card>

                <mat-card class="example-box" cdkDrag class="example-card" appearance="outlined"
                  style="min-width: 650px;background: white;padding: 16px;margin-bottom: 10px;margin-left: 10px;"
                  *ngIf="card.type_report == 'Comparativo' && cboColumn == 'Departamento'">
                  <mat-card-header style="display: contents;width: 100%;padding-bottom: 14px;padding-top: 0px;">
                    <mat-card-title style="width: 100%;">
                      <ion-row>
                        <ion-col sizeXs="12" sizeSm="12" sizeMd="6" sizeLg="6">
                          <p style="font-weight: 500;margin: 0;" *ngIf="!card.store_2.length">{{card.store_1}}</p>
                          <p style="font-weight: 500;margin: 0;">{{card.store_1}} - {{card.store_2}}</p>
                          <p style="font-size: 20px;">{{card.column}}</p>
                        </ion-col>
                        <ion-col sizeXs="12" sizeSm="12" sizeMd="6" sizeLg="6" style="text-align: end;">
                          <p style="font-size: 20px;">Semana {{card.semana}}</p>
                        </ion-col>
                      </ion-row>
                    </mat-card-title>
                  </mat-card-header>

                  <table mat-table [dataSource]="card.data_comparativo" class="example-container mat-elevation-z8"
                    tabindex="0">

                    <ng-container matColumnDef="departamento1">
                      <th mat-header-cell *matHeaderCellDef> Departamento </th>
                      <td mat-cell *matCellDef="let element"> {{element.departament}} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"> Total </td>
                    </ng-container>

                    <ng-container matColumnDef="anio1">
                      <th mat-header-cell *matHeaderCellDef> Año </th>
                      <td mat-cell *matCellDef="let element" class="cellAnio">{{element.anio_1.anio}}</td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"></td>
                    </ng-container>

                    <ng-container matColumnDef="porcentage1">
                      <th mat-header-cell *matHeaderCellDef> % </th>
                      <td mat-cell *matCellDef="let element">{{element.anio_1.proc_1}} %</td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter">100 %</td>
                    </ng-container>

                    <ng-container matColumnDef="importe1">
                      <th mat-header-cell *matHeaderCellDef> Importe </th>
                      <td mat-cell *matCellDef="let element" class="cellData"> {{element.anio_1.import |
                        currency:'PEN':'symbol':'1.2-2':'es-PE'
                        }} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"> {{card.total_import_1 |
                        currency:'PEN':'symbol':'1.2-2':'es-PE'
                        }} </td>
                    </ng-container>

                    <ng-container matColumnDef="unidades1">
                      <th mat-header-cell *matHeaderCellDef> Unid. </th>
                      <td mat-cell *matCellDef="let element" class="cellData"> {{element.anio_1.unid}} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter">{{card.total_stock_1}}</td>
                    </ng-container>

                    <ng-container matColumnDef="anio2">
                      <th mat-header-cell *matHeaderCellDef> Año </th>s
                      <td mat-cell *matCellDef="let element" class="cellAnio">{{element.anio_2.anio}}</td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"></td>
                    </ng-container>

                    <ng-container matColumnDef="porcentage2">
                      <th mat-header-cell *matHeaderCellDef> % </th>
                      <td mat-cell *matCellDef="let element">{{element.anio_2.proc_2}} %</td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter">100 %</td>
                    </ng-container>

                    <ng-container matColumnDef="importe2">
                      <th mat-header-cell *matHeaderCellDef> Importe </th>
                      <td mat-cell *matCellDef="let element" class="cellData"> {{element.anio_2.import |
                        currency:'PEN':'symbol':'1.2-2':'es-PE'
                        }} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter"> {{card.total_import_2 |
                        currency:'PEN':'symbol':'1.2-2':'es-PE'
                        }} </td>
                    </ng-container>

                    <ng-container matColumnDef="unidades2">
                      <th mat-header-cell *matHeaderCellDef> Unid. </th>
                      <td mat-cell *matCellDef="let element" class="cellData"> {{element.anio_2.unid}} </td>
                      <td mat-footer-cell *matFooterCellDef class="cellFooter">{{card.total_stock_2}}</td>
                    </ng-container>

                    <ng-container matColumnDef="diff_procentage">
                      <th mat-header-cell *matHeaderCellDef style="background: #ffe97b;"> Diff S/. </th>
                      <td mat-cell *matCellDef="let element">{{element.diffPorc}} %</td>
                      <td mat-footer-cell *matFooterCellDef>
                        {{card.diffImportTotal}} %</td>
                    </ng-container>

                    <ng-container matColumnDef="diff_unid">
                      <th mat-header-cell *matHeaderCellDef style="background: #ffe97b;"> Diff Unid </th>
                      <td mat-cell *matCellDef="let element">{{element.diffUnid}} % </td>
                      <td mat-footer-cell *matFooterCellDef>{{card.diffUnidTotal}}
                        %</td>
                    </ng-container>



                    <tr mat-header-row *matHeaderRowDef="displayedColumns_1"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns_1;"></tr>

                    <tr mat-footer-row *matFooterRowDef="displayedColumns_1" class="example-first-footer-row"></tr>
                  </table>


                </mat-card>
                }
              </div>

            </ion-col>
          </ion-row>

        </div>
      </div>
    </mat-drawer-content>
  </mat-drawer-container>
</ion-content>